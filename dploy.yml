project:
  git_repository: 'git@github.com:ajespa-siae/gestio-accessos.git'
  deploy:
    directory: '/home/siae-accessos/htdocs/accessos.siae.cat'
    shared_directories:
      - 'storage/logs'
      - 'storage/app'
      - 'storage/framework'
    before_commands: # Before symlink switch
      - 'cd {release_directory} && php8.4 /usr/local/bin/composer install --no-dev --optimize-autoloader'
      - 'cp {release_directory}/.env.production {release_directory}/.env'
      - 'cd {release_directory} && php8.4 artisan key:generate --force'
      - 'cd {release_directory} && php8.4 artisan storage:link'
      - 'cd {release_directory} && php8.4 artisan migrate --force'
      - 'cd {release_directory} && php8.4 artisan optimize'
      - 'cd {release_directory} && php8.4 artisan queue:restart'
      - 'find {release_directory} -type d -exec chmod 0775 {} \;'
      - 'find {release_directory} -type f -exec chmod 0664 {} \;'
      - 'chown -R siae-accessos:siae-accessos {release_directory}'
    after_commands: # After symlink switch
      - 'sudo systemctl reload php8.4-fpm'
